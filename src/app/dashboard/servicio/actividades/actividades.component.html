<div class="container-fluid fondo">
    <br />
    <div class="row">
        <div class="col col-md-7">
            <h3>{{ servi.servicio }}</h3>
        </div>
    </div>
    <div class="row">
        <div class="col col-md-7">
            <div class="alert alert-primary" style="min-height: 600px;">
                <table title="Servicios" matSort aria-label="Listado de servicios" id="tblServicios" name="tblServicios"
                    style="width: 100%" class="table table-hover">
                    <tr>
                        <th style="width: 35%;">Compromiso</th>
                        <th style="width: 25%;">Responsable</th>
                        <th style="width: 15%;">Vencimiento </th>
                        <th style="width: 5%;">
                            <button mat-icon-button color="primary" aria-label="Tramites/Servicios"
                                matTooltip="Trámites/Servicios" (click)="openDialog()">
                                <mat-icon>add_circle_outline</mat-icon>
                            </button>
                        </th>
                    </tr>
                    <tbody>
                        <ng-container *ngFor="let actividad of actividades">
                            <tr (click)="selectActividad(actividad)"
                                [ngClass]="{seleccionado: seleccionado == actividad}" style="cursor: pointer;">
                                <td>{{ actividad.descripcion }}</td>
                                <td>{{ actividad.responsable }}</td>
                                <td style="text-align: center;"><span class="{{ actividad.semaforoColor }}"
                                        matTooltip="{{ actividad.semaforoEtiqueta }}">
                                        {{ actividad.vencimiento | date: 'dd/MM/yyyy' }}
                                    </span>
                                </td>
                                <td>
                                    <button mat-icon-button (click)="delete(actividad, $event)" hidden>
                                        <mat-icon color="warn">delete</mat-icon>
                                    </button>
                                </td>
                            </tr>
                        </ng-container>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="col col-md-5">
            <div class="alert alert-primary" style="min-height: 600px;">
                <mat-tab-group color="primary">
                    <mat-tab>
                        <ng-template mat-tab-label>
                            <mat-icon class="example-tab-icon">event</mat-icon>
                            Detalles del compromiso
                        </ng-template>
                        <br />
                        <div class="contenedor">
                            <h4> {{ seleccionado.descripcion }} </h4>
                            <mat-form-field class="example-full-width" appearance="fill"
                                *ngIf="seleccionado.vencimiento">
                                <mat-label>Compromiso</mat-label>
                                <input matInput [(ngModel)]="seleccionado.descripcion" name="compromiso" required>
                            </mat-form-field>
                            <mat-form-field class="example-full-width" appearance="fill"
                                *ngIf="seleccionado.vencimiento">
                                <mat-label>Descripción</mat-label>
                                <textarea matInput name="observ" [(ngModel)]="seleccionado.observaciones"
                                    placeholder="Describa el compromiso o actividad"></textarea>
                            </mat-form-field>
                            <mat-form-field appearance="fill" style="width: 45%;" *ngIf="seleccionado.vencimiento">
                                <mat-label>Vencimiento</mat-label>
                                <input matInput [matDatepicker]="picker" [(ngModel)]="seleccionado.vencimiento">
                                <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                                <mat-datepicker #picker></mat-datepicker>
                            </mat-form-field>&nbsp;&nbsp;
                            <mat-form-field appearance="fill" style="width: 52%;" *ngIf="seleccionado.vencimiento">
                                <mat-label>Responsable</mat-label>
                                <mat-select name="categoria" [(ngModel)]="seleccionado.responsableId">
                                    <mat-option *ngFor="let person of personas" [value]="person.id">
                                        {{ person.nombre }} {{ person.apellidos }}</mat-option>
                                </mat-select>
                            </mat-form-field>
                            <mat-slide-toggle [(ngModel)]="seleccionado.terminado"
                                *ngIf="seleccionado.vencimiento">Terminado</mat-slide-toggle>
                            <button mat-raised-button color="primary" class="float-end" cdkFocusInitial
                                (click)="guardaActividad();" [disabled]="me.id != seleccionado.responsableId"
                                *ngIf="seleccionado.vencimiento">Guardar</button>&nbsp;&nbsp;
                        </div>
                    </mat-tab>
                    <mat-tab>
                        <ng-template mat-tab-label>
                            <mat-icon class="example-tab-icon">attach_file</mat-icon>
                            Archivos relacionados
                        </ng-template>
                        <br />
                        <div class="contenedor" *ngIf="seleccionado.vencimiento">
                            <h4> {{ seleccionado.descripcion }} </h4>
                            <button mat-icon-button color="primary" aria-label="Tramites/Servicios"
                                matTooltip="Trámites/Servicios" (click)="nuevoDocumento()" class="float-end">
                                <mat-icon>add_circle_outline</mat-icon>
                            </button>
                            <table aria-label="equipo" style="width: 100%" class="table table-hover table-striped">
                                <thead>
                                    <tr>
                                        <th></th>
                                        <th></th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let archivo of documentos">
                                        <td>
                                            <div style="word-wrap: break-word; cursor: pointer;">
                                                <a (click)="descargaArchivo(archivo.ruta, archivo.archivo)"
                                                    *ngIf="archivo.ruta && archivo.archivo"
                                                    matTooltip="{{archivo.archivo}} ({{archivo.descripcion}})">
                                                    {{ archivo.archivo.length < 50 ? archivo.archivo :
                                                        archivo.archivo.substring(0,50) + '...' }}</a>
                                            </div>
                                        </td>
                                        <td>
                                            <span>{{ archivo.size | fileSize }} </span>
                                        </td>
                                        <td>
                                            <button mat-icon-button aria-label="Eliminar"
                                                (click)="borraDocumento(archivo)">
                                                <mat-icon color="warn">delete</mat-icon>
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </mat-tab>
                </mat-tab-group>
            </div>
        </div>
    </div>
</div>